<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="simulator">
<title>James-Stein with the Simulator • simulator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="James-Stein with the Simulator">
<meta property="og:description" content="simulator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">simulator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/simulator.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/lasso.html">The Lasso with the Simulator</a>
    <a class="dropdown-item" href="../articles/james-stein.html">James-Stein with the Simulator</a>
    <a class="dropdown-item" href="../articles/elastic-net.html">The Elastic Net with the Simulator</a>
    <a class="dropdown-item" href="../articles/fdr.html">Benjamini-Hochberg with the Simulator</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jacobbien/simulator/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>James-Stein with the Simulator</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jacobbien/simulator/blob/HEAD/vignettes/james-stein.Rmd" class="external-link"><code>vignettes/james-stein.Rmd</code></a></small>
      <div class="d-none name"><code>james-stein.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Suppose we observe <span class="math inline">\(Y\sim N_p(\theta,
I_p)\)</span> and wish to estimate <span class="math inline">\(\theta\)</span>. The MLE, <span class="math inline">\(\hat\theta_{MLE}=Y\)</span>, would seem like the
best estimator for <span class="math inline">\(\theta\)</span>. However,
James and Stein showed that <span class="math display">\[
\hat\theta_{JS}=\left(1-\frac{p-2}{\|Y\|^2}\right)Y
\]</span> dominates the MLE when <span class="math inline">\(p&gt;2\)</span> in terms of squared-error loss,
<span class="math inline">\(\|\hat\theta - \theta\|^2\)</span>. We can
see this in simulation.</p>
</div>
<div class="section level2">
<h2 id="using-the-simulator">Using the simulator<a class="anchor" aria-label="anchor" href="#using-the-simulator"></a>
</h2>
<p>While this simulation requires so little code that we might just put
it all in one file, maintaining the standard simulator file structure is
beneficial for consistency across projects. When I look back at a
project from several years ago, it’s always helpful to look for the
files <code>main.R</code>, <code>model_functions.R</code>,
<code>method_functions.R</code>, and <code>evals_functions.R</code>. The
file <code>main.R</code> contains the code that is actually run to carry
out the simulations. The other three files define the individual
ingredients that are needed in the simulation.</p>
<div class="section level3">
<h3 id="define-the-models">Define the model(s)<a class="anchor" aria-label="anchor" href="#define-the-models"></a>
</h3>
<p>In <code>model_functions.R</code>, I create a function that will
generate the model above with <span class="math inline">\(p\)</span> and
<span class="math inline">\(\|\theta\|_2\)</span> as parameters to be
passed at the time of simulation. (Without loss of generality, we take
<span class="math inline">\(\theta=\|\theta\|_2 e_1\)</span>.)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jacobbien/simulator" class="external-link">simulator</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_normal_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta_norm</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/new_model.html">new_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>            label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"p = %s, theta_norm = %s"</span>, <span class="va">p</span>, <span class="va">theta_norm</span><span class="op">)</span>,</span>
<span>            params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta_norm <span class="op">=</span> <span class="va">theta_norm</span>, p <span class="op">=</span> <span class="va">p</span>,</span>
<span>                          theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            simulate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">p</span>, <span class="va">nsim</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsim</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">p</span>, <span class="va">nsim</span><span class="op">)</span></span>
<span>              <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">Y</span>, <span class="fu"><a href="https://rdrr.io/r/base/col.html" class="external-link">col</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># make each col its own list element</span></span>
<span>            <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-the-methods">Define the methods<a class="anchor" aria-label="anchor" href="#define-the-methods"></a>
</h3>
<p>In <code>method_functions.R</code>, we create two functions, one for
each method:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_method.html">new_method</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mle"</span>, label <span class="op">=</span> <span class="st">"MLE"</span>,</span>
<span>                  method <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">draw</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>est <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">js</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_method.html">new_method</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"jse"</span>, label <span class="op">=</span> <span class="st">"James-Stein"</span>,</span>
<span>                 method <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">draw</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="va">l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">draw</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>                   <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>est <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">p</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">l2</span><span class="op">)</span> <span class="op">*</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-the-metrics-of-interest">Define the metric(s) of interest<a class="anchor" aria-label="anchor" href="#define-the-metrics-of-interest"></a>
</h3>
<p>And in <code>eval_functions.R</code>, we create a function for the
squared-error metric</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqr_err</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_metric.html">new_metric</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"sqrerr"</span>, label <span class="op">=</span> <span class="st">"Squared Error Loss"</span>,</span>
<span>                      metric <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">out</span><span class="op">)</span> <span class="op">{</span></span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">est</span> <span class="op">-</span> <span class="va">model</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>                      <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-main-simulation-putting-the-components-together">The main simulation: putting the components together<a class="anchor" aria-label="anchor" href="#the-main-simulation-putting-the-components-together"></a>
</h3>
<p>Finally, we are ready to write <code>main.R</code>. Let’s start by
simulating from two models, one in which <span class="math inline">\(p=2\)</span> and one in which <span class="math inline">\(p=6\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_simulation.html">new_simulation</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"js-v-mle"</span>,</span>
<span>                       label <span class="op">=</span> <span class="st">"Investigating the James-Stein Estimator"</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/generate_model.html">generate_model</a></span><span class="op">(</span><span class="va">make_normal_model</span>, theta_norm <span class="op">=</span> <span class="fl">1</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                 vary_along <span class="op">=</span> <span class="st">"p"</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulate_from_model.html">simulate_from_model</a></span><span class="op">(</span>nsim <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/run_method.html">run_method</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">js</span>, <span class="va">mle</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">sqr_err</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ..Created model and saved in norm/p_2/theta_norm_1/model.Rdata</span></span>
<span><span class="co">## ..Created model and saved in norm/p_6/theta_norm_1/model.Rdata</span></span>
<span><span class="co">## ..Simulated 20 draws in 0 sec and saved in norm/p_2/theta_norm_1/r1.Rdata</span></span>
<span><span class="co">## ..Simulated 20 draws in 0 sec and saved in norm/p_6/theta_norm_1/r1.Rdata</span></span>
<span><span class="co">## ..Performed James-Stein in 0 seconds (on average over 20 sims)</span></span>
<span><span class="co">## ..Performed MLE in 0 seconds (on average over 20 sims)</span></span>
<span><span class="co">## ..Performed James-Stein in 0 seconds (on average over 20 sims)</span></span>
<span><span class="co">## ..Performed MLE in 0 seconds (on average over 20 sims)</span></span>
<span><span class="co">## ..Evaluated James-Stein in terms of Squared Error Loss, Computing time (sec)</span></span>
<span><span class="co">## ..Evaluated MLE in terms of Squared Error Loss, Computing time (sec)</span></span>
<span><span class="co">## ..Evaluated James-Stein in terms of Squared Error Loss, Computing time (sec)</span></span>
<span><span class="co">## ..Evaluated MLE in terms of Squared Error Loss, Computing time (sec)</span></span></code></pre>
<p>The output messages inform us about what files have been created. The
<code>generate_model</code> call leads to the creation of two models.
Both <code>theta_norm</code> and <code>p</code> are passed via
<code>generate_model</code>. However, our use of
<code>vary_along = "p"</code> indicates to the simulator that we wish to
generate a separate model for each entry in the list
<code>p = list(2, 6)</code>.</p>
<p>The first two lines of output indicate that these models have been
created and saved to file (with directories named based on the names of
the corresponding model objects). Next, the
<code>simulate_from_model</code> function takes each of these models and
simulates 20 random draws from each model. Recall that objects of class
<code>Model</code> specify how data is generated from it. The third and
fourth lines of output tells us how long this took and where the files
are saved. The <code>run_method</code> function takes our two methods of
interest (the MLE and the James-Stein estimator) and runs these on each
random draw. Lines 5-8 tell us how long each of these took. Finally, the
function <code>evaluate</code> takes our metric (or more generally a
list of metrics) of interest and applies these to all outputs (of all
methods, over all draws, across all models). Lines 9-14 report which
metrics have been computed. (Note that a method’s timing information is
included by default.)</p>
<p>The returned object, <code>sim1</code>, is a <code>Simulation</code>
object. It contains references to all the saved files that have been
generated. The object <code>sim1</code> is itself automatically saved,
so if you close and reopen the R session, you would simply type
<code>sim1 &lt;- load_simulation("js-v-mle")</code> to reload it.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-look-at-the-results">A look at the results<a class="anchor" aria-label="anchor" href="#a-look-at-the-results"></a>
</h2>
<p>We are now ready to examine the results of the simulation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eval.html">plot_eval</a></span><span class="op">(</span><span class="va">sim1</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span><span class="op">)</span></span></code></pre></div>
<p><img src="james-stein_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>As expected, the James-Stein estimator does better than the MLE when
<span class="math inline">\(p=6\)</span>, whereas for <span class="math inline">\(p=2\)</span> they perform the same (as should be
the case since they are in fact identical!). We see that the individual
plots’ titles come from each model’s label. Likewise, each boxplot is
labeled with the corresponding method’s label. And the y-axis is labeled
with the label of the metric used. In the simulator, each label is part
of the corresponding simulation component and used when needed. For
example, if instead of a plot we wished to view this as a table, we
could do the following:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tabulate_eval.html">tabulate_eval</a></span><span class="op">(</span><span class="va">sim1</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, output_type <span class="op">=</span> <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<!-- generated by simulator on Wed Feb  1 19:14:00 2023. -->
<table class="table">
<caption>A comparison of Mean Squared Error Loss (averaged over 20
replicates).</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">James-Stein</th>
<th align="left">MLE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">p = 2, theta_norm = 1</td>
<td align="left">1.0766179 (0.23462879)</td>
<td align="left">1.0766179 (0.23462879)</td>
</tr>
<tr class="even">
<td align="left">p = 6, theta_norm = 1</td>
<td align="left">0.4072435 (0.09179764)</td>
<td align="left">1.1065917 (0.12905231)</td>
</tr>
</tbody>
</table>
<p>If this document were in latex, we would instead use
<code>output_type="latex"</code>. Since reporting so many digits is not
very meaningful, we may wish to adjust the number of digits shown:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tabulate_eval.html">tabulate_eval</a></span><span class="op">(</span><span class="va">sim1</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, output_type <span class="op">=</span> <span class="st">"markdown"</span>,</span>
<span>              format_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nsmall <span class="op">=</span> <span class="fl">1</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- generated by simulator on Wed Feb  1 19:14:00 2023. -->
<table class="table">
<caption>A comparison of Mean Squared Error Loss (averaged over 20
replicates).</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">James-Stein</th>
<th align="left">MLE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">p = 2, theta_norm = 1</td>
<td align="left">1.1 (0.23)</td>
<td align="left">1.1 (0.23)</td>
</tr>
<tr class="even">
<td align="left">p = 6, theta_norm = 1</td>
<td align="left">0.4 (0.09)</td>
<td align="left">1.1 (0.13)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="demonstration-of-additional-simulator-features">Demonstration of additional simulator features<a class="anchor" aria-label="anchor" href="#demonstration-of-additional-simulator-features"></a>
</h2>
<div class="section level3">
<h3 id="plotting-a-metric-as-a-function-of-a-numerical-model-parameter">Plotting a metric as a function of a numerical model parameter<a class="anchor" aria-label="anchor" href="#plotting-a-metric-as-a-function-of-a-numerical-model-parameter"></a>
</h3>
<p>Rather than looking at just two models, we might wish to generate a
sequence of models, indexed by <span class="math inline">\(p\)</span>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_simulation.html">new_simulation</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"js-v-mle2"</span>,</span>
<span>                       label <span class="op">=</span> <span class="st">"Investigating James-Stein Estimator"</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/generate_model.html">generate_model</a></span><span class="op">(</span><span class="va">make_normal_model</span>, vary_along <span class="op">=</span> <span class="st">"p"</span>,</span>
<span>                 theta_norm <span class="op">=</span> <span class="fl">1</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulate_from_model.html">simulate_from_model</a></span><span class="op">(</span>nsim <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/run_method.html">run_method</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">js</span>, <span class="va">mle</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">sqr_err</span><span class="op">)</span></span></code></pre></div>
<p>We could display this with boxplots or a table as before…</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eval.html">plot_eval</a></span><span class="op">(</span><span class="va">sim2</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span><span class="op">)</span></span></code></pre></div>
<p><img src="james-stein_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tabulate_eval.html">tabulate_eval</a></span><span class="op">(</span><span class="va">sim2</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, output_type <span class="op">=</span> <span class="st">"markdown"</span>,</span>
<span>              format_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nsmall <span class="op">=</span> <span class="fl">2</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- generated by simulator on Wed Feb  1 19:14:00 2023. -->
<table class="table">
<caption>A comparison of Mean Squared Error Loss (averaged over 20
replicates).</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">James-Stein</th>
<th align="left">MLE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">p = 1, theta_norm = 1</td>
<td align="left">8.61 (2.65)</td>
<td align="left">1.11 (0.37)</td>
</tr>
<tr class="even">
<td align="left">p = 6, theta_norm = 1</td>
<td align="left">0.41 (0.09)</td>
<td align="left">1.11 (0.13)</td>
</tr>
<tr class="odd">
<td align="left">p = 11, theta_norm = 1</td>
<td align="left">0.16 (0.02)</td>
<td align="left">0.98 (0.07)</td>
</tr>
<tr class="even">
<td align="left">p = 16, theta_norm = 1</td>
<td align="left">0.21 (0.05)</td>
<td align="left">1.05 (0.11)</td>
</tr>
<tr class="odd">
<td align="left">p = 21, theta_norm = 1</td>
<td align="left">0.13 (0.04)</td>
<td align="left">1.03 (0.08)</td>
</tr>
<tr class="even">
<td align="left">p = 26, theta_norm = 1</td>
<td align="left">0.13 (0.02)</td>
<td align="left">1.06 (0.08)</td>
</tr>
</tbody>
</table>
<p>…however, since <code>p</code> is a numerical value, it might be more
informative to plot <code>p</code> on the x-axis.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eval_by.html">plot_eval_by</a></span><span class="op">(</span><span class="va">sim2</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, varying <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span></span></code></pre></div>
<p><img src="james-stein_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>We can also use base plot functions rather than
<code>ggplot2</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eval_by.html">plot_eval_by</a></span><span class="op">(</span><span class="va">sim2</span>, metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, varying <span class="op">=</span> <span class="st">"p"</span>, use_ggplot2 <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="james-stein_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="easy-access-to-results-of-simulation">Easy access to results of simulation<a class="anchor" aria-label="anchor" href="#easy-access-to-results-of-simulation"></a>
</h3>
<p>The functions used above have many options allowing, for example,
plots and tables to be customized in many ways. The intention is that
most of what one typically wishes to display can be easily done with
<code>simulator</code> functions. However, in cases where one wishes to
work directly with the generated results, one may output the evaluated
metrics as a <code>data.frame</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/evals.html">evals</a></span><span class="op">(</span><span class="va">sim2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   Model Method Draw    sqrerr time</span></span>
<span><span class="co">## 1 norm/p_1/theta_norm_1    jse r1.1  1.648343    0</span></span>
<span><span class="co">## 2 norm/p_1/theta_norm_1    jse r1.2  2.015828    0</span></span>
<span><span class="co">## 3 norm/p_1/theta_norm_1    jse r1.3 43.065347    0</span></span>
<span><span class="co">## 4 norm/p_1/theta_norm_1    jse r1.4  3.497164    0</span></span>
<span><span class="co">## 5 norm/p_1/theta_norm_1    jse r1.5  2.918979    0</span></span>
<span><span class="co">## 6 norm/p_1/theta_norm_1    jse r1.6  1.130775    0</span></span></code></pre>
<p>One can also extract more specific slices of the evaluated metrics.
For example:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evals.html">evals</a></span><span class="op">(</span><span class="va">sim2</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">6</span>, methods <span class="op">=</span> <span class="st">"jse"</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span> <span class="va">as.data.frame</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span> <span class="va">head</span></span></code></pre></div>
<pre><code><span><span class="co">##                   Model Method Draw    sqrerr time</span></span>
<span><span class="co">## 1 norm/p_6/theta_norm_1    jse r1.1 0.1919394    0</span></span>
<span><span class="co">## 2 norm/p_6/theta_norm_1    jse r1.2 1.2470374    0</span></span>
<span><span class="co">## 3 norm/p_6/theta_norm_1    jse r1.3 0.1022489    0</span></span>
<span><span class="co">## 4 norm/p_6/theta_norm_1    jse r1.4 0.5981796    0</span></span>
<span><span class="co">## 5 norm/p_6/theta_norm_1    jse r1.5 0.1977684    0</span></span>
<span><span class="co">## 6 norm/p_6/theta_norm_1    jse r1.6 0.2248202    0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="varying-along-more-than-one-parameter">Varying along more than one parameter<a class="anchor" aria-label="anchor" href="#varying-along-more-than-one-parameter"></a>
</h3>
<p>We can also vary models across more than one parameter by passing
multiple variable names through <code>vary_along</code>. For example,
suppose we wish to vary both the dimension <code>p</code> and the norm
of the mean vector <code>theta_norm</code>. The following generates a
simulation with 30 models, corresponding to all pairs between 3 values
of <code>p</code> and 10 values of <code>theta_norm</code>. For each of
these 30 models, we generate 20 simulations on which we run two methods
and then evaluate one metric:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_simulation.html">new_simulation</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"js-v-mle3"</span>,</span>
<span>                       label <span class="op">=</span> <span class="st">"Investigating the James-Stein Estimator"</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/generate_model.html">generate_model</a></span><span class="op">(</span><span class="va">make_normal_model</span>, vary_along <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"theta_norm"</span><span class="op">)</span>,</span>
<span>                 theta_norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulate_from_model.html">simulate_from_model</a></span><span class="op">(</span>nsim <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/run_method.html">run_method</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">js</span>, <span class="va">mle</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">sqr_err</span><span class="op">)</span></span></code></pre></div>
<p>Having run all of these simulations, we can make plots that vary
<span class="math inline">\(\|\theta\|_2\)</span> for fixed values of
<span class="math inline">\(p\)</span>. To do so, we use the
<code>subset_simulation</code> function, that allows us to select (out
of all 30 models) those ones meeting a certain criterion such as <span class="math inline">\(p\)</span> having a certain value. (Although not
relevant here, we are also able to subset simulations by
<code>index</code> and by <code>method</code>.)</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/subset_simulation.html">subset_simulation</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_eval_by.html">plot_eval_by</a></span><span class="op">(</span>metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, varying <span class="op">=</span> <span class="st">"theta_norm"</span>, main <span class="op">=</span> <span class="st">"p = 11"</span><span class="op">)</span></span></code></pre></div>
<p><img src="james-stein_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p>We see that the MLE’s risk is constant whereas the James-Stein risk
does depend on <span class="math inline">\(\|\theta\|_2\)</span> with
the greatest improvement occurring when <span class="math inline">\(\|\theta\|_2\)</span> is small.</p>
<p>Suppose we wish to look at a different “slice” of the simulation such
as when <span class="math inline">\(p=1\)</span>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/subset_simulation.html">subset_simulation</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_eval_by.html">plot_eval_by</a></span><span class="op">(</span>metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, varying <span class="op">=</span> <span class="st">"theta_norm"</span>, main <span class="op">=</span> <span class="st">"p = 1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="james-stein_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>Clearly, something strange is happening here. To investigate, we
start by looking at the raw squared-error values (whereas by default
<code>plot_eval_by</code> shows the sample mean over the random
draws).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/subset_simulation.html">subset_simulation</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_eval_by.html">plot_eval_by</a></span><span class="op">(</span>metric_name <span class="op">=</span> <span class="st">"sqrerr"</span>, varying <span class="op">=</span> <span class="st">"theta_norm"</span>, </span>
<span>               type <span class="op">=</span> <span class="st">"raw"</span>, main <span class="op">=</span> <span class="st">"p = 1"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 19 rows containing missing values (`geom_smooth()`).</span></span></code></pre>
<p><img src="james-stein_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<p>We notice a huge outlier at two values of <code>theta_norm</code>.
Let’s use this as an opportunity to show how debugging works with the
<code>simulator</code> (certainly a common task when writing
simulations!).</p>
</div>
<div class="section level3">
<h3 id="examining-earlier-stages-of-a-simulation">Examining earlier stages of a simulation<a class="anchor" aria-label="anchor" href="#examining-earlier-stages-of-a-simulation"></a>
</h3>
<p>Let’s start by looking at the outlier when <code>theta_norm</code> is
0. Let’s check that <span class="math inline">\(\theta\)</span> is a
scalar (because <span class="math inline">\(p=1\)</span>) and that it is
equal to zero:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">theta_norm</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre></div>
<pre><code><span><span class="co">## Model Component</span></span>
<span><span class="co">##  name: norm/p_1/theta_norm_0</span></span>
<span><span class="co">##  label: p = 1, theta_norm = 0</span></span>
<span><span class="co">##  params: theta_norm p theta</span></span>
<span><span class="co">##  (Add @params to end of this object to see parameters.)</span></span>
<span><span class="co">##  (Add @simulate to end of this object to see how data is simulated.)</span></span></code></pre>
<p>When we print the model object <code>m</code>, we see some basic
information about it, including a reminder of what parameters are
included.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Observe that this model’s name is norm/p_1/theta_norm_0.
This name was created by &lt;code&gt;generate_model&lt;/code&gt;. The first part of
the name, &lt;code&gt;norm/&lt;/code&gt;, came from us when we defined
&lt;code&gt;make_normal_model&lt;/code&gt; to have that name. The next two parts
were added by &lt;code&gt;generate_model&lt;/code&gt; because we were using
&lt;code&gt;vary_along=c("p", "theta_norm")&lt;/code&gt;. If a parameter named
&lt;code&gt;param&lt;/code&gt; is in &lt;code&gt;vary_along&lt;/code&gt;, then the name of the
created model will append something of the form &lt;code&gt;param_X&lt;/code&gt;.
When &lt;code&gt;param&lt;/code&gt; is integer-valued or a double rounded to several
decimal places then &lt;code&gt;X&lt;/code&gt; will simply be this value. For
example, since &lt;code&gt;p&lt;/code&gt; is integer-valued, we see that
&lt;code&gt;p_1&lt;/code&gt; has been appended to &lt;code&gt;norm/&lt;/code&gt;. When
&lt;code&gt;param&lt;/code&gt; is of some other type, &lt;code&gt;X&lt;/code&gt; is a hashed
version of the value of &lt;code&gt;param&lt;/code&gt; (using &lt;code&gt;sha1&lt;/code&gt; from
the package &lt;a href="https://cran.r-project.org/package=digest" class="external-link"&gt;&lt;code&gt;digest&lt;/code&gt;&lt;/a&gt;).
This allows us to assign the model to a unique (with high probability)
file name for each distinct value of &lt;code&gt;param&lt;/code&gt; even if it is of
some complicated type such as a matrix or a list.&lt;/p&gt;'><sup>1</sup></a> While we can use
<code>m@params$theta</code>, we can write more simply:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="va">theta</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>As expected, <span class="math inline">\(\theta\)</span> is a scalar
equal to 0.</p>
<p>Now, let’s examine the <span class="math inline">\(Y\)</span> values
that were drawn:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">theta_norm</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">d</span></span></code></pre></div>
<pre><code><span><span class="co">## Draws Component</span></span>
<span><span class="co">##  name: norm/p_1/theta_norm_0</span></span>
<span><span class="co">##  label: (Block 1:) 20 draws from p = 1, theta_norm = 0</span></span>
<span><span class="co">##  (Add @draws to end of this object to see what was simulated.)</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span><span class="op">@</span><span class="va">draws</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="co"># this is a list, one per draw of Y.  Look at first 4 elements.</span></span></code></pre></div>
<pre><code><span><span class="co">## $r1.1</span></span>
<span><span class="co">## [1] -0.4094454</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $r1.2</span></span>
<span><span class="co">## [1] 0.8909694</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $r1.3</span></span>
<span><span class="co">## [1] -0.8653704</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $r1.4</span></span>
<span><span class="co">## [1] 1.464271</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">d</span><span class="op">@</span><span class="va">draws</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">## -2.23182 -0.76999 -0.11728 -0.05857  0.49413  2.45053</span></span></code></pre>
<p>Nothing unusual looking yet. Let’s look directly at the squared
errors that were computed to find which simulation realization is the
problematic one. We’ll restrict ourselves to the James-Stein estimator
in this case:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evals.html">evals</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">theta_norm</span> <span class="op">==</span> <span class="fl">0</span>, methods <span class="op">=</span> <span class="st">"jse"</span><span class="op">)</span></span>
<span><span class="va">e</span></span></code></pre></div>
<pre><code><span><span class="co">## Evals Component</span></span>
<span><span class="co">##  model_name: norm/p_1/theta_norm_0    index: 1 (20 nsim)</span></span>
<span><span class="co">##  method_name(s): jse (labeled: James-Stein)</span></span>
<span><span class="co">##  metric_name(s): sqrerr, time</span></span>
<span><span class="co">##  metric_label(s): Squared Error Loss, Computing time (sec)</span></span>
<span><span class="co">##  (Add @evals to end of this object or use as.data.frame to see more.)</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sqrerr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">##    4.054    4.263    6.137  356.414   10.503 6399.438</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sqrerr</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                    Model Method  Draw   sqrerr time</span></span>
<span><span class="co">## 14 norm/p_1/theta_norm_0    jse r1.14 6399.438    0</span></span></code></pre>
<p>We see that it is simulation draw r1.14 that is the culprit, having a
squared error of 6399.4379981. Let’s look at what the James-Stein output
was in this realization.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/output.html">output</a></span><span class="op">(</span><span class="va">sim3</span>, <span class="va">p</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">theta_norm</span> <span class="op">==</span> <span class="fl">0</span>, methods <span class="op">=</span> <span class="st">"jse"</span><span class="op">)</span></span>
<span><span class="va">o</span><span class="op">@</span><span class="va">out</span><span class="op">$</span><span class="va">r1.14</span></span></code></pre></div>
<pre><code><span><span class="co">## $est</span></span>
<span><span class="co">## [1] -79.99649</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##       0       0       0</span></span></code></pre>
<p>It was very negative. How did this come about? Let’s look at <span class="math inline">\(Y\)</span> in this case:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span><span class="op">@</span><span class="va">draws</span><span class="op">$</span><span class="va">r1.14</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.0125025</span></span></code></pre>
<p>This was relatively close to zero so that when we computed</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">p</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">d</span><span class="op">@</span><span class="va">draws</span><span class="op">$</span><span class="va">r1.14</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6398.438</span></span></code></pre>
<p>we get something quite large. Of course, when <span class="math inline">\(p=1\)</span>, the James-Stein estimator does not
perform shrinkage but rather it inflates <span class="math inline">\(Y\)</span>, something that no one would expect to
be a good idea! Now that we have investigated these outliers, we are
confident that they do not reflect a coding error; rather, they are a
“real” portrayal of the performance of the James-Stein estimator’s
performance in this situation.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jacob Bien.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
